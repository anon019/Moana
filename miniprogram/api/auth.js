"use strict";const e=require("../common/vendor.js"),t=require("./request.js");exports.getCurrentUser=async function(){return t.request.get("/auth/me")},exports.logout=function(){e.index.removeStorageSync("access_token"),e.index.removeStorageSync("refresh_token")},exports.mockLogin=function(){const t={id:"mock-user-001",openid:"mock-openid-001",nickname:"测试用户",avatar_url:"",created_at:(new Date).toISOString()},n={access_token:"mock-access-token",refresh_token:"mock-refresh-token",token_type:"bearer",expires_in:3600};return e.index.setStorageSync("access_token",n.access_token),e.index.setStorageSync("refresh_token",n.refresh_token),{user:t,tokens:n}},exports.wechatLogin=async function(n){const o=await e.index.login({});if(!o.code)throw new Error("微信登录失败");const r=await t.request.post("/auth/wechat/login",{code:o.code,user_info:n});return e.index.setStorageSync("access_token",r.access_token),e.index.setStorageSync("refresh_token",r.refresh_token),r};
