"use strict";var e=Object.defineProperty,s=(s,t,i)=>(((s,t,i)=>{t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i})(s,"symbol"!=typeof t?t+"":t,i),i);const t=require("../stores/child.js");const i=new class{constructor(){s(this,"sessionStart",null),s(this,"lastReminderTime",0),s(this,"reminderInterval",6e5)}startSession(){this.sessionStart=Date.now(),this.lastReminderTime=Date.now()}isSessionActive(){return null!==this.sessionStart}ensureSession(){this.isSessionActive()||this.startSession()}getSessionMinutes(){return this.sessionStart?(Date.now()-this.sessionStart)/6e4:0}checkLimits(){if(t.useChildStore().settings.rest_reminder_enabled){if(Date.now()-this.lastReminderTime>=this.reminderInterval)return this.lastReminderTime=Date.now(),{exceeded:!1,reminder:!0,message:"看了一会儿了，眨眨眼睛休息一下～"}}return{exceeded:!1,message:""}}getRemainingInfo(){const e=t.useChildStore(),s=e.settings,i=this.getSessionMinutes(),n=e.todayDuration+i;return{sessionRemaining:Math.max(0,s.session_limit_minutes-i),dailyRemaining:Math.max(0,s.daily_limit_minutes-n),sessionProgress:Math.min(100,i/s.session_limit_minutes*100),dailyProgress:Math.min(100,n/s.daily_limit_minutes*100)}}endSession(){const e=this.getSessionMinutes();return t.useChildStore().addTodayDuration(e),this.sessionStart=null,Math.round(e)}resetReminder(){this.lastReminderTime=Date.now()}formatMinutes(e){if(e<1)return"不到1分钟";if(e<60)return`${Math.round(e)}分钟`;const s=Math.floor(e/60),t=Math.round(e%60);return t>0?`${s}小时${t}分钟`:`${s}小时`}};exports.timeLimitManager=i;
