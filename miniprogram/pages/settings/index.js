"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/child.js"),i=require("../../api/play.js"),n=e.defineComponent({__name:"index",setup(n){const s=t.useChildStore(),a=e.ref(20),o=e.ref(88),r=e.reactive({daily_limit_minutes:60,session_limit_minutes:30,rest_reminder_enabled:!0}),d=e.reactive({duration:0,count:0,streak:0,progress:0});function u(){e.index.navigateBack()}function c(t){r.rest_reminder_enabled=t.detail.value,async function(){try{await s.updateSettings({daily_limit_minutes:r.daily_limit_minutes,session_limit_minutes:r.session_limit_minutes,rest_reminder_enabled:r.rest_reminder_enabled}),e.index.showToast({title:"已保存",icon:"success"})}catch(t){e.index.showToast({title:"保存失败",icon:"none"})}}()}function l(){e.index.showToast({title:"Moana v1.0.0",icon:"none"})}return e.onMounted(()=>{const t=e.index.getSystemInfoSync();a.value=t.statusBarHeight||20,o.value=a.value+44,async function(){if(await s.fetchSettings(),Object.assign(r,s.settings),s.currentChild)try{const e=await i.getPlayStats(s.currentChild.id);d.duration=Math.round(e.today_duration),d.count=e.total_plays,d.streak=e.streak_days,d.progress=Math.min(100,e.today_duration/r.daily_limit_minutes*100)}catch(e){console.log("加载统计失败")}}()}),(t,i)=>({a:e.o(u),b:a.value+"px",c:o.value+"px",d:r.rest_reminder_enabled,e:e.o(c),f:e.t(d.duration),g:d.progress+"%",h:e.t(d.count),i:e.t(d.streak),j:e.o(l)})}}),s=e._export_sfc(n,[["__scopeId","data-v-bebf26a6"]]);wx.createPage(s);
