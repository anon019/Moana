"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/child.js"),n=require("../../stores/content.js"),o=require("../../utils/time-limit.js");if(!Array){(e.resolveComponent("circle")+e.resolveComponent("stop")+e.resolveComponent("linearGradient")+e.resolveComponent("defs")+e.resolveComponent("svg"))()}const a=e.defineComponent({__name:"index",setup(a){const l=t.useChildStore(),r=n.useContentStore(),u=e.ref(null),i=e.ref([]),s=e.ref("all"),v=e.ref(20),c=e.ref(0),d=e.computed(()=>"all"===s.value?i.value:i.value.filter(e=>e.content_type===s.value));function p(e){if(s.value=e,d.value.length>0){d.value.find(e=>{var t;return e.id===(null==(t=u.value)?void 0:t.id)})||(u.value=d.value[0])}}const f=e.ref(!1),m=e.ref(0);let h=null;const _=e.ref({question:"2 + 3 = ?",answer:5,options:[4,5,6,7]}),y=e.ref(!1),g=e.ref(10);let k=null,M=null;const b=e.computed(()=>{const e=l.settings.session_limit_minutes;return v.value/e*100});function x(){if(!u.value)return;const t=u.value,n={picture_book:"/pages/play/picture-book",nursery_rhyme:"/pages/play/nursery-rhyme",video:"/pages/play/video"}[t.content_type||"picture_book"]||"/pages/play/picture-book";e.index.navigateTo({url:`${n}?id=${t.id}&autoplay=1`})}function C(e){return{picture_book:"ðŸ“š",nursery_rhyme:"ðŸŽµ",video:"ðŸŽ¬"}[e.content_type||"picture_book"]||"ðŸ“š"}function I(e){return`type-${(e.content_type||"picture_book").replace("_","-")}`}function w(e){if(!e)return"";const t=e.match(/çš„(.+)/);return t&&t[1].length>2?t[1].slice(0,5):e.slice(0,5)}function L(e){var t;null==(t=null==e?void 0:e.stopPropagation)||t.call(e),h&&clearInterval(h),m.value=0;let n=0;h=setInterval(()=>{n++,m.value=Math.min(100,Math.round(n/30*100)),n>=30&&(q(),S(),f.value=!0)},100)}function q(){h&&(clearInterval(h),h=null),m.value=0}function S(){const e=Math.floor(5*Math.random())+1,t=Math.floor(5*Math.random())+1,n=e+t,o=[n];for(;o.length<4;){const e=n+Math.floor(5*Math.random())-2;e>0&&!o.includes(e)&&o.push(e)}_.value={question:`${e} + ${t} = ?`,answer:n,options:o.sort(()=>Math.random()-.5)}}function j(){const t=60*o.timeLimitManager.getRemainingInfo().sessionRemaining;v.value=Math.floor(t/60),c.value=Math.floor(t%60);const n=o.timeLimitManager.checkLimits();n.exceeded?(e.index.showToast({title:n.message,icon:"none"}),setTimeout(()=>e.index.navigateBack(),2e3)):n.reminder&&(y.value=!0,g.value=10,k=setInterval(()=>{g.value--,g.value<=0&&(clearInterval(k),y.value=!1,o.timeLimitManager.resetReminder())},1e3))}function B(e){return e.content_type?e.content_type:e.video_url?"video":e.audio_url&&!e.pages?"nursery_rhyme":"picture_book"}return e.computed(()=>100-b.value),e.onLoad(e=>{(null==e?void 0:e.contentId)&&r.fetchContentDetail(e.contentId).then(()=>{u.value=r.currentContent}),o.timeLimitManager.ensureSession()}),e.onMounted(()=>{!async function(){try{for(await r.fetchGeneratedList(!0);r.hasMoreContent;)await r.fetchMoreContent();const e=r.generatedList.map(e=>({...e,content_type:B(e)}));console.log("[child] åŠ è½½å…¨éƒ¨å†…å®¹:",e.length,"ä¸ª"),i.value=e,i.value.length>0&&(u.value=i.value[0])}catch(e){console.log("åŠ è½½å†…å®¹å¤±è´¥",e)}}(),M=setInterval(j,1e3),j()}),e.onUnmounted(()=>{M&&clearInterval(M),k&&clearInterval(k),q(),o.timeLimitManager.endSession()}),(t,n)=>{return e.e({a:e.f(12,(t,n,o)=>({a:t,b:e.n("s"+t)})),b:e.t(v.value),c:e.t(String(c.value).padStart(2,"0")),d:u.value},u.value?e.e({e:u.value.cover_url},u.value.cover_url?{f:u.value.cover_url}:{g:e.t(C(u.value))},{h:e.t((o=u.value,{picture_book:"ç»˜æœ¬",nursery_rhyme:"å„¿æ­Œ",video:"è§†é¢‘"}[o.content_type||"picture_book"]||"ç»˜æœ¬")),i:e.n(I(u.value)),j:e.f(5,(e,t,n)=>({a:e})),k:e.t(u.value.title),l:e.o(x)}):{},{m:i.value.length>0},i.value.length>0?{n:"all"===s.value?1:"",o:e.o(e=>p("all")),p:"picture_book"===s.value?1:"",q:e.o(e=>p("picture_book")),r:"nursery_rhyme"===s.value?1:"",s:e.o(e=>p("nursery_rhyme")),t:"video"===s.value?1:"",v:e.o(e=>p("video")),w:e.f(d.value,(t,n,o)=>{var a,l,r;return e.e({a:e.t(C(t)),b:e.t(w(t.title)),c:(null==(a=u.value)?void 0:a.id)===t.id},(null==(l=u.value)||l.id,t.id,{}),{d:t.id,e:e.n(I(t)),f:e.n({active:(null==(r=u.value)?void 0:r.id)===t.id}),g:.1*n+"s",h:e.o(e=>function(e){u.value=e}(t),t.id)})})}:{},{x:e.p({cx:"50",cy:"50",r:"45","stroke-width":"6",fill:"none",stroke:"rgba(255,255,255,0.3)"}),y:e.p({cx:"50",cy:"50",r:"45","stroke-width":"6",fill:"none",stroke:"url(#exitGradient)","stroke-dasharray":283,"stroke-dashoffset":283-283*m.value/100,"stroke-linecap":"round",transform:"rotate(-90 50 50)"}),z:e.p({offset:"0%","stop-color":"#FF6B9D"}),A:e.p({offset:"50%","stop-color":"#FECA57"}),B:e.p({offset:"100%","stop-color":"#5CD85A"}),C:e.p({id:"exitGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%"}),D:e.p({viewBox:"0 0 100 100"}),E:e.t(m.value>0?Math.ceil(3-.03*m.value):"æ‹œæ‹œ"),F:m.value>0?1:"",G:0===m.value},(m.value,{}),{H:e.o(L),I:e.o(q),J:e.o(q),K:f.value},f.value?{L:e.t(_.value.question),M:e.f(_.value.options,(t,n,o)=>({a:e.t(t),b:t,c:e.o(n=>function(t){t===_.value.answer?(f.value=!1,e.index.navigateBack()):(e.index.showToast({title:"å†æƒ³æƒ³å“¦~",icon:"none"}),S())}(t),t)})),N:e.o(e=>f.value=!1)}:{},{O:y.value},y.value?{P:e.t(g.value),Q:e.t(g.value)}:{});var o}}}),l=e._export_sfc(a,[["__scopeId","data-v-e38ef707"]]);wx.createPage(l);
