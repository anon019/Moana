"use strict";const e=require("../../common/vendor.js"),o=require("../../api/content.js"),n=e.defineComponent({__name:"video",setup(n){const i=e.ref(""),l=e.ref(null),t=e.ref(!0),a=e.ref(!1),u=e.ref(0),d=e.ref(20);let v=null;function r(){console.log("[video] 开始播放"),a.value=!0}function s(){console.log("[video] 暂停"),a.value=!1}function c(){console.log("[video] 播放结束"),a.value=!1}function f(o){console.error("[video] 播放错误:",o),e.index.showToast({title:"视频播放失败",icon:"none"})}function _(e){u.value=e.detail.currentTime||0}function h(){v&&(v.seek(0),v.play())}function g(){var o;(null==(o=l.value)?void 0:o.video_url)?(e.index.showLoading({title:"正在保存..."}),e.index.downloadFile({url:l.value.video_url,success:o=>{200===o.statusCode?e.index.saveVideoToPhotosAlbum({filePath:o.tempFilePath,success:()=>{e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"success"})},fail:o=>{var n;e.index.hideLoading(),console.error("保存视频失败:",o),(null==(n=o.errMsg)?void 0:n.includes("auth deny"))?e.index.showModal({title:"提示",content:"需要您授权保存到相册",success:o=>{o.confirm&&e.index.openSetting()}}):e.index.showToast({title:"保存失败",icon:"none"})}}):(e.index.hideLoading(),e.index.showToast({title:"下载失败",icon:"none"}))},fail:()=>{e.index.hideLoading(),e.index.showToast({title:"下载失败",icon:"none"})}})):e.index.showToast({title:"视频地址不可用",icon:"none"})}function x(){var o;(null==(o=l.value)?void 0:o.source_book_id)&&e.index.navigateTo({url:`/pages/play/picture-book?id=${l.value.source_book_id}`})}function p(){e.index.navigateBack()}function m(){setTimeout(()=>{v=e.index.createVideoContext("video-player")},100)}return e.onShareAppMessage(()=>{var e,o;return{title:(null==(e=l.value)?void 0:e.title)||"来看这个有趣的视频",path:`/pages/play/video?id=${i.value}`,imageUrl:(null==(o=l.value)?void 0:o.cover_url)||""}}),e.onShareTimeline(()=>{var e,o;return{title:(null==(e=l.value)?void 0:e.title)||"来看这个有趣的视频",query:`id=${i.value}`,imageUrl:(null==(o=l.value)?void 0:o.cover_url)||""}}),e.onLoad(o=>{i.value=(null==o?void 0:o.id)||"";const n=e.index.getSystemInfoSync();d.value=n.statusBarHeight||20,null==o||o.fromGenerate}),e.onMounted(()=>{!async function(){t.value=!0;try{const n=e.index.getStorageSync("temp_video");if(n)return l.value=n,e.index.removeStorageSync("temp_video"),t.value=!1,void m();if(i.value){const e=await o.getContentDetail(i.value);l.value=e,m()}}catch(n){console.error("加载视频失败:",n),e.index.showToast({title:"加载失败",icon:"none"}),setTimeout(()=>e.index.navigateBack(),1500)}finally{t.value=!1}}()}),e.onUnmounted(()=>{v&&v.stop()}),(o,n)=>{var i,a,u,v,m,y,T,w,S,k,b,L;return e.e({a:null==(i=l.value)?void 0:i.video_url},(null==(a=l.value)?void 0:a.video_url)?{b:l.value.video_url,c:l.value.cover_url,d:e.o(r),e:e.o(s),f:e.o(c),g:e.o(f),h:e.o(_)}:{},{i:e.t((null==(u=l.value)?void 0:u.title)||"视频播放"),j:null==(v=l.value)?void 0:v.duration},(null==(m=l.value)?void 0:m.duration)?{k:e.t((L=l.value.duration,`${Math.floor(L/60)}:${Math.floor(L%60).toString().padStart(2,"0")}`))}:{},{l:null==(T=null==(y=l.value)?void 0:y.personalization)?void 0:T.child_name},(null==(S=null==(w=l.value)?void 0:w.personalization)?void 0:S.child_name)?{m:e.t(l.value.personalization.child_name)}:{},{n:e.o(g),o:e.o(h),p:null==(k=l.value)?void 0:k.source_book_id},(null==(b=l.value)?void 0:b.source_book_id)?{q:e.o(x)}:{},{r:e.o(p),s:d.value+"px",t:t.value},(t.value,{}))}}});n.__runtimeHooks=6;const i=e._export_sfc(n,[["__scopeId","data-v-8ffcb6e0"]]);wx.createPage(i);
