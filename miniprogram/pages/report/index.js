"use strict";const t=require("../../common/vendor.js"),a=require("../../stores/child.js"),e=require("../../api/play.js");Math||o();const o=()=>"../../components/NavBar/NavBar.js",n=t.defineComponent({__name:"index",setup(o){const n=a.useChildStore(),i=t.computed(()=>{var t;return(null==(t=n.currentChild)?void 0:t.name)||"å®è´"}),s=t.ref({totalDuration:"0åˆ†é’Ÿ",totalBooks:0,streakDays:0,interactionRate:0}),c=t.ref([{name:"ä¸€",date:"",hasActivity:!1,isToday:!1},{name:"äºŒ",date:"",hasActivity:!1,isToday:!1},{name:"ä¸‰",date:"",hasActivity:!1,isToday:!1},{name:"å››",date:"",hasActivity:!1,isToday:!1},{name:"äº”",date:"",hasActivity:!1,isToday:!1},{name:"å…­",date:"",hasActivity:!1,isToday:!1},{name:"æ—¥",date:"",hasActivity:!1,isToday:!1}]),r=t.ref([{name:"ä¹ æƒ¯å…»æˆ",icon:"ğŸŒŸ",count:5},{name:"è®¤çŸ¥ä¸–ç•Œ",icon:"ğŸŒ",count:3},{name:"æƒ…æ„Ÿç¤¾äº¤",icon:"ğŸ’",count:2}]),u=t.computed(()=>s.value.streakDays>=7?`å¤ªæ£’äº†ï¼${i.value}å·²ç»è¿ç»­å­¦ä¹ ${s.value.streakDays}å¤©ï¼Œç»§ç»­ä¿æŒï¼`:s.value.streakDays>=3?`${i.value}è¡¨ç°å¾ˆæ£’ï¼Œå†åšæŒå‡ å¤©å°±èƒ½è·å¾—å‘¨å¾½ç« ï¼`:`æ¯å¤©å­¦ä¹ ä¸€ç‚¹ç‚¹ï¼Œ${i.value}ä¼šè¶Šæ¥è¶Šæ£’ï¼`),l={habit:"ğŸŒŸ",cognition:"ğŸŒ",emotion:"ğŸ’",brush_teeth:"ğŸ¦·",wash_hands:"ğŸ§¼",sharing:"ğŸ¤",colors:"ğŸ¨",animals:"ğŸ¦",numbers:"ğŸ”¢"};function d(t){if(t<60)return`${t}åˆ†é’Ÿ`;const a=Math.floor(t/60),e=t%60;return e>0?`${a}å°æ—¶${e}åˆ†`:`${a}å°æ—¶`}async function v(){var t;if(n.currentChild)try{const a=await e.getLearningStats(n.currentChild.id);s.value={totalDuration:d(a.total_duration_minutes),totalBooks:a.total_books+a.total_songs+a.total_videos,streakDays:a.streak_days,interactionRate:Math.round(100*a.interaction_rate)},function(t){const a=new Date,e=a.getDay()||7;c.value=c.value.map((o,n)=>{const i=n+1-e,s=new Date(a);s.setDate(a.getDate()+i);const c=s.toISOString().split("T")[0],r=t.find(t=>t.date===c);return{...o,date:c,isToday:0===i,hasActivity:(null==r?void 0:r.has_activity)||!1}})}(a.daily_activity),(t=a.top_themes).length>0&&(r.value=t.slice(0,3).map(t=>({name:t.theme_name,icon:l[t.theme_id]||"ğŸ“š",count:t.count})))}catch(a){console.log("ç»¼åˆç»Ÿè®¡ API æœªå°±ç»ªï¼Œå°è¯•ç­”é¢˜ç»Ÿè®¡");try{const t=await e.getPlayStats(n.currentChild.id);s.value={totalDuration:"0åˆ†é’Ÿ",totalBooks:t.total_questions>0?Math.ceil(t.total_questions/3):0,streakDays:0,interactionRate:Math.round(100*t.accuracy_rate)}}catch{console.log("åŠ è½½ç»Ÿè®¡å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼")}}}return t.onMounted(()=>{!function(){const t=new Date,a=t.getDay()||7;c.value=c.value.map((e,o)=>{const n=o+1-a,i=new Date(t);return i.setDate(t.getDate()+n),{...e,date:i.toISOString().split("T")[0],isToday:0===n,hasActivity:!1}})}(),v()}),(a,e)=>({a:t.p({title:"å­¦ä¹ æŠ¥å‘Š","show-back":!0}),b:t.t(i.value),c:t.t(s.value.totalDuration),d:t.t(s.value.totalBooks),e:t.t(s.value.streakDays),f:t.t(s.value.interactionRate),g:t.f(c.value,(a,e,o)=>({a:t.t(a.name),b:t.t(a.hasActivity?"âœ…":"â—‹"),c:a.date,d:a.hasActivity?1:"",e:a.isToday?1:""})),h:t.f(r.value,(a,e,o)=>({a:t.t(e+1),b:t.t(a.icon),c:t.t(a.name),d:t.t(a.count),e:a.name})),i:t.t(u.value)})}}),i=t._export_sfc(n,[["__scopeId","data-v-ca079ad3"]]);wx.createPage(i);
