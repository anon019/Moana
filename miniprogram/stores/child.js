"use strict";const e=require("../common/vendor.js"),t=require("../api/request.js"),i=e.defineStore("child",()=>{const i=e.ref([]),n=e.ref(null),a=e.ref({child_id:"",daily_limit_minutes:60,session_limit_minutes:30,rest_reminder_enabled:!0}),r=e.ref(0),u=e.computed(()=>i.value.length>0),l=e.computed(()=>{var e;if(!(null==(e=n.value)?void 0:e.birth_date))return 0;const t=new Date(n.value.birth_date),i=new Date;return 12*(i.getFullYear()-t.getFullYear())+(i.getMonth()-t.getMonth())}),s=e.computed(()=>{const e=l.value;if(e<=0)return"";const t=Math.floor(e/12),i=e%12;return 0===t?`${i}个月`:0===i?`${t}岁`:`${t}岁${i}个月`});function c(t){n.value=t,e.index.setStorageSync("current_child_id",t.id),d()}async function d(){if(n.value)try{a.value=await t.request.get(`/child/${n.value.id}/settings`)}catch(e){a.value={child_id:n.value.id,daily_limit_minutes:60,session_limit_minutes:30,rest_reminder_enabled:!0}}}return{children:i,currentChild:n,settings:a,todayDuration:r,hasChild:u,currentChildAge:s,currentChildAgeMonths:l,setCurrentChild:c,addChild:async function(e){const n=await t.request.post("/child",e);return i.value.push(n),1===i.value.length&&c(n),n},fetchChildren:async function(){try{const a=await t.request.get("/child/list");i.value=a;const r=e.index.getStorageSync("current_child_id");if(r){const e=i.value.find(e=>e.id===r);if(e)return n.value=e,void(await d())}i.value.length>0&&c(i.value[0])}catch(a){console.error("获取孩子列表失败:",a)}},fetchSettings:d,updateSettings:async function(e){if(n.value)try{a.value=await t.request.put(`/child/${n.value.id}/settings`,{...a.value,...e})}catch(i){throw console.error("更新设置失败:",i),i}},fetchTodayDuration:async function(){if(n.value)try{const e=await t.request.get(`/play/stats/${n.value.id}`);r.value=e.today_duration}catch(e){r.value=0}},addTodayDuration:function(e){r.value+=e}}});exports.useChildStore=i;
