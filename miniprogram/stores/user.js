"use strict";const e=require("../common/vendor.js"),t=require("../api/auth.js"),o=e.defineStore("user",()=>{const o=e.ref(null),n=e.computed(()=>!!o.value);async function r(){try{o.value=await t.getCurrentUser()}catch(n){const r=e.index.getStorageSync("access_token");if(!r||!r.startsWith("mock-"))throw o.value=null,n;{const{user:e}=t.mockLogin();o.value=e}}}return{user:o,isLoggedIn:n,login:async function(e){try{return await t.wechatLogin(e),await r(),!0}catch(n){console.error("登录失败，尝试模拟登录:",n);try{const{user:e}=t.mockLogin();return o.value=e,console.log("模拟登录成功"),!0}catch(c){return console.error("模拟登录也失败:",c),!1}}},fetchUser:r,logout:function(){t.logout(),o.value=null},checkLogin:function(){return!!e.index.getStorageSync("access_token")}}});exports.useUserStore=o;
