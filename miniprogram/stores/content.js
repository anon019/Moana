"use strict";const e=require("../common/vendor.js"),t=require("../api/content.js"),n=e.defineStore("content",()=>{const n=e.ref(null),r=e.ref([]),a=e.ref(null),o=e.ref(!1),l=e.ref(0),u=e.ref(!0),i=e.ref(!1);return{themes:n,generatedList:r,currentContent:a,isGenerating:o,generatingProgress:l,hasMoreContent:u,isLoadingMore:i,fetchThemes:async function(){if(n.value)return n.value;try{return n.value=await t.getThemes(),n.value}catch(e){throw console.error("获取主题失败:",e),e}},createPictureBook:async function(e){o.value=!0,l.value=0;try{const n=setInterval(()=>{if(l.value<90){const e=10*Math.random()+2;l.value=Math.min(95,l.value+e)}},1500),o=await t.generatePictureBook(e);return clearInterval(n),l.value=100,r.value.unshift(o),a.value=o,o}catch(n){throw console.error("生成绘本失败:",n),n}finally{o.value=!1}},fetchGeneratedList:async function(e=!1){if(!e&&r.value.length>0)return r.value;try{const e=await t.getGeneratedList({limit:20,offset:0});return r.value=e.items,u.value=e.has_more||e.items.length>=20,e.items}catch(n){throw console.error("获取内容列表失败:",n),n}},fetchMoreContent:async function(){if(i.value||!u.value)return[];i.value=!0;try{const e=r.value.length,n=await t.getGeneratedList({limit:20,offset:e});return n.items.length>0&&(r.value=[...r.value,...n.items]),u.value=n.has_more||n.items.length>=20,n.items}catch(e){throw console.error("加载更多内容失败:",e),e}finally{i.value=!1}},fetchContentDetail:async function(e){try{console.log("[fetchContentDetail] 请求内容详情:",e);const n=await t.getContentDetail(e);return console.log("[fetchContentDetail] 响应数据:",JSON.stringify(n).slice(0,500)),a.value=n,a.value}catch(n){throw console.error("[fetchContentDetail] 获取内容详情失败:",(null==n?void 0:n.message)||n),n}},setCurrentContent:function(e){a.value=e},clearGenerating:function(){o.value=!1,l.value=0},removeContent:async function(e){var n;try{await t.deleteContent(e),r.value=r.value.filter(t=>t.id!==e),(null==(n=a.value)?void 0:n.id)===e&&(a.value=null)}catch(o){throw console.error("删除内容失败:",o),o}}}});exports.useContentStore=n;
