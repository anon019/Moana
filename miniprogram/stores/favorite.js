"use strict";const e=require("../common/vendor.js"),t=require("../api/favorite.js"),a=e.defineStore("favorite",()=>{const a=e.ref([]),r=e.ref(new Set),o=e.ref(!1),i=e.ref(!0),n=e.ref(1),v=e.computed(()=>a.value.length);function u(e){return r.value.has(e)}return{favorites:a,favoriteCount:v,loading:o,hasMore:i,isFavorite:u,toggleFavorite:async function(e){try{return u(e)?(await t.removeFavorite(e),r.value.delete(e),a.value=a.value.filter(t=>t.content_id!==e),!1):(await t.addFavorite(e),r.value.add(e),!0)}catch(o){throw console.error("切换收藏失败:",o),o}},fetchFavorites:async function(e=!1){if(!o.value&&(e||i.value)){o.value=!0;try{const o=e?1:n.value,v=await t.getFavoriteList({page:o,page_size:20});e?(a.value=v.items,r.value=new Set(v.items.map(e=>e.content_id))):(a.value.push(...v.items),v.items.forEach(e=>r.value.add(e.content_id))),n.value=o+1,i.value=a.value.length<v.total}catch(v){console.error("获取收藏列表失败:",v)}finally{o.value=!1}}},checkContentFavorite:async function(e){try{(await t.checkFavorite(e)).is_favorite&&r.value.add(e)}catch(a){}}}});exports.useFavoriteStore=a;
